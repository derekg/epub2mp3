{
  "objectives": {
    "obj_3ca1c327": {
      "id": "obj_3ca1c327",
      "description": "Fix corrupted HTML: remove duplicate elements from multi-branch merge, restore single clean DOM structure",
      "user_experience": {
        "visible": [
          "One options card with voice, format, bitrate, speed, text-processing, checkboxes",
          "Duration estimate inside chapters card, not sidebar",
          "History section at bottom of main column"
        ],
        "behavior": [
          "No duplicate IDs in DOM",
          "All controls visible and functional"
        ],
        "performance": []
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "templates/index.html"
        ],
        "must_not_change": [
          "app.py API endpoints"
        ],
        "can_modify": []
      },
      "attempts": [
        {
          "approach": "Full rewrite of index.html removing all duplicate IDs/elements from multi-branch merge. Single clean DOM structure.",
          "timestamp": "2026-02-21T21:55:53.316560Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T21:51:43.671851Z",
      "updated_at": "2026-02-21T21:55:56.155481Z"
    },
    "obj_7aff4add": {
      "id": "obj_7aff4add",
      "description": "Multi-job queue panel showing all active and completed conversions",
      "user_experience": {
        "visible": [
          "Jobs sidebar appears when first conversion starts",
          "Each job card: status dot, title, progress bar, download links",
          "Form resets after starting conversion so user can queue another book"
        ],
        "behavior": [
          "Each job has independent SSE connection for parallel updates",
          "New jobs inserted at top of list",
          "Sidebar stacks below form on narrow screens"
        ],
        "performance": [
          "Multiple jobs update in parallel without blocking each other"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "Backend already supports concurrent jobs via jobs dict and SSE per job_id"
        ],
        "must_not_change": [],
        "can_modify": [
          "templates/index.html"
        ]
      },
      "attempts": [
        {
          "approach": "Two-column flex layout, jobs-sidebar with job cards, addJob()/listenForProgress()/updateJobCard()/resetForm() functions, independent EventSource per job",
          "timestamp": "2026-02-21T20:12:46.723452Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html",
            "test_queue.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:46.718932Z",
      "updated_at": "2026-02-21T20:12:46.727086Z"
    },
    "obj_bb28cedd": {
      "id": "obj_bb28cedd",
      "description": "Cancel button for in-progress EPUB conversions",
      "user_experience": {
        "visible": [
          "Cancel button appears below progress bar during conversion",
          "Button shows Cancelling... immediately on click",
          "Button disappears on complete, error, or cancelled"
        ],
        "behavior": [
          "DELETE /api/cancel/{job_id} stops the asyncio task",
          "CancelledError handler cleans up temp files and sets status=cancelled",
          "SSE stream surfaces cancelled status to UI",
          "Cannot cancel a completed or already-cancelled job (400)"
        ],
        "performance": [
          "Cancel feels instant — optimistic UI before server responds"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "app.py: jobs dict, run_conversion asyncio task, SSE progress stream"
        ],
        "must_not_change": [],
        "can_modify": [
          "app.py, templates/index.html"
        ]
      },
      "attempts": [
        {
          "approach": "Stored asyncio Task in jobs dict, added DELETE endpoint, CancelledError handler, cancel button in UI",
          "timestamp": "2026-02-21T20:12:18.677695Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "app.py",
            "templates/index.html",
            "test_cancel.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:18.673157Z",
      "updated_at": "2026-02-21T20:12:18.681390Z"
    },
    "obj_8218ee68": {
      "id": "obj_8218ee68",
      "description": "Persist completed job download links via localStorage",
      "user_experience": {
        "visible": [
          "Recent Conversions section below main form after first completion",
          "Each entry shows title, author, date, download pill buttons",
          "Expired label on pills when server files are gone",
          "Clear history button"
        ],
        "behavior": [
          "Saves last 10 completed jobs to localStorage",
          "HEAD-checks each download URL on render to detect expired files",
          "History survives page refresh"
        ],
        "performance": [
          "HEAD checks are async and non-blocking"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "Download endpoint: GET /api/download/{job_id}/{filename}"
        ],
        "must_not_change": [],
        "can_modify": [
          "templates/index.html"
        ]
      },
      "attempts": [
        {
          "approach": "localStorage JSON array, addHistoryEntry/renderHistory/checkFileAvailable functions, escapeHtml for XSS safety, integrated into showDownloads()",
          "timestamp": "2026-02-21T20:12:32.102393Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html",
            "test_history.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:32.098376Z",
      "updated_at": "2026-02-21T20:12:32.105654Z"
    },
    "obj_4d7edc01": {
      "id": "obj_4d7edc01",
      "description": "Add cancel button to each sidebar job card (not just the main form)",
      "user_experience": {
        "visible": [
          "Each active job card in sidebar has a Cancel button",
          "Cancel button disappears when job completes or is cancelled"
        ],
        "behavior": [
          "Clicking Cancel calls DELETE /api/cancel/{job_id}",
          "Works for all queued jobs, not just the most recent"
        ],
        "performance": []
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "templates/index.html"
        ],
        "must_not_change": [
          "app.py cancel endpoint"
        ],
        "can_modify": []
      },
      "attempts": [
        {
          "approach": "Added .job-cancel-btn per job card, wired to cancelJob(jobId) which calls DELETE /api/cancel/{job_id}. Button hides on complete/error/cancelled.",
          "timestamp": "2026-02-21T21:55:53.320803Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T21:51:47.765872Z",
      "updated_at": "2026-02-21T21:55:56.159533Z"
    },
    "obj_f8fe072e": {
      "id": "obj_f8fe072e",
      "description": "Add micro-animations and motion to make the UI feel alive and responsive",
      "user_experience": {
        "visible": [
          "Cards fade+slide in on appearance",
          "Progress bar animates smoothly",
          "Job cards slide in from right when added",
          "Success state has a brief green flash",
          "Status dot pulses while processing",
          "Button has satisfying press animation"
        ],
        "behavior": [
          "Animations respect prefers-reduced-motion"
        ],
        "performance": [
          "All animations run at 60fps using CSS transforms"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "templates/index.html"
        ],
        "must_not_change": [],
        "can_modify": []
      },
      "attempts": [
        {
          "approach": "fadeSlideUp on cards/sections, slideInRight on job cards, dotPulse on processing status, successPop on success dot, button scale on :active. prefers-reduced-motion respected.",
          "timestamp": "2026-02-21T21:55:53.332030Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T21:51:57.645512Z",
      "updated_at": "2026-02-21T21:55:56.166938Z"
    },
    "obj_13a3fc72": {
      "id": "obj_13a3fc72",
      "description": "MP3 output bitrate selection (64/128/192 kbps)",
      "user_experience": {
        "visible": [
          "Bitrate dropdown: 64 kbps (small), 128 kbps (standard), 192 kbps (default)",
          "Estimated file size shown below selector based on duration and bitrate"
        ],
        "behavior": [
          "Bitrate threaded through: UI -> API -> convert_epub_to_mp3 -> convert_wav_to_mp3",
          "Voice preview encoder stays at 128 kbps regardless"
        ],
        "performance": [
          "No performance impact — just changes lameenc bit rate setting"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "converter.py: convert_wav_to_mp3() uses lameenc, hardcoded 192kbps"
        ],
        "must_not_change": [],
        "can_modify": [
          "converter.py, app.py, templates/index.html"
        ]
      },
      "attempts": [
        {
          "approach": "Added bitrate param to convert_wav_to_mp3 and convert_epub_to_mp3, Form field in API, select UI with file size estimator",
          "timestamp": "2026-02-21T20:12:59.315473Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "converter.py",
            "app.py",
            "templates/index.html",
            "test_bitrate.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:59.311179Z",
      "updated_at": "2026-02-21T20:12:59.318984Z"
    },
    "obj_25b26988": {
      "id": "obj_25b26988",
      "description": "Narration speed control for TTS output (0.75x to 2x)",
      "user_experience": {
        "visible": [
          "Pill-style segmented control: 0.75x 1x 1.25x 1.5x 2x (1x default)"
        ],
        "behavior": [
          "Speed resamples audio via scipy after TTS synthesis",
          "Falls back to numpy interpolation if scipy unavailable",
          "Invalid speeds snapped to nearest valid value",
          "Speed threaded through: UI -> API -> convert_epub_to_mp3 -> generate_speech"
        ],
        "performance": [
          "Resampling adds minimal overhead post-synthesis"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "tts.py: generate_speech(), converter.py: text_to_audio(), convert_epub_to_mp3()"
        ],
        "must_not_change": [],
        "can_modify": [
          "tts.py, converter.py, app.py, templates/index.html"
        ]
      },
      "attempts": [
        {
          "approach": "_resample_audio() in tts.py using scipy/numpy, speed param threaded through all layers, pill radio UI, speed validation with nearest-valid snapping",
          "timestamp": "2026-02-21T20:12:46.711110Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "tts.py",
            "converter.py",
            "app.py",
            "templates/index.html",
            "test_speed.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:46.707239Z",
      "updated_at": "2026-02-21T20:12:46.714930Z"
    },
    "obj_64d12a98": {
      "id": "obj_64d12a98",
      "description": "Mobile-responsive layout: full-screen usable on phone without horizontal scroll",
      "user_experience": {
        "visible": [
          "Single column on screens < 768px",
          "Jobs sidebar stacks below form on mobile",
          "Touch-friendly tap targets (44px min)",
          "Speed pills and option selects full-width on small screens"
        ],
        "behavior": [
          "No horizontal overflow on 375px viewport"
        ],
        "performance": [
          "No layout shift when jobs sidebar appears"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "templates/index.html"
        ],
        "must_not_change": [],
        "can_modify": []
      },
      "attempts": [
        {
          "approach": "Single-column below 900px, jobs sidebar stacks below form. 600px breakpoint: 2-col progress grid, larger touch targets, full-width controls.",
          "timestamp": "2026-02-21T21:55:53.328072Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T21:51:52.415678Z",
      "updated_at": "2026-02-21T21:55:56.163306Z"
    },
    "obj_25d9d5d4": {
      "id": "obj_25d9d5d4",
      "description": "Fix TTS crash on long chapters by chunking text before synthesis",
      "user_experience": {
        "visible": [
          "Long books convert successfully without crashing",
          "Progress still updates per-chapter as before"
        ],
        "behavior": [
          "Text split at sentence boundaries into chunks of ~500 words max",
          "Audio chunks concatenated with a brief silence between sentences",
          "If a single sentence exceeds the limit, split at word boundaries",
          "Error in one chunk is surfaced cleanly, not a silent crash"
        ],
        "performance": [
          "No noticeable quality degradation at chunk boundaries"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "tts.py: generate_speech() calls model.generate_audio(voice_state, text) with full text — model hard-limits at ~1000 tokens causing tensor mismatch crash"
        ],
        "must_not_change": [
          "generate_speech() public signature"
        ],
        "can_modify": [
          "tts.py"
        ]
      },
      "attempts": [
        {
          "approach": "Added _split_text_into_chunks() to tts.py: splits at sentence boundaries (regex on .!?;), falls back to word boundaries for sentences >100 words, concatenates audio with 100ms silence. Pre-chunking happens in generate_speech() before model.generate_audio() call.",
          "timestamp": "2026-02-21T21:05:36.882897Z",
          "result": "success",
          "learned": "Pocket TTS model.generate_audio_stream() already calls split_into_best_sentences internally but fails when a single sentence has no punctuation and exceeds 1000 audio frames. Root cause: sequence_length=1000 in init_states() for the flow LM.",
          "files_changed": [
            "tts.py",
            "test_speed.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T21:03:02.636248Z",
      "updated_at": "2026-02-21T21:05:36.890368Z"
    },
    "obj_355fbe43": {
      "id": "obj_355fbe43",
      "description": "Show estimated audiobook listening time before converting",
      "user_experience": {
        "visible": [
          "Per-chapter duration next to word count (e.g. ~12 min)",
          "Estimated listening time banner below chapter list",
          "Note shown when speed read or summary mode is active"
        ],
        "behavior": [
          "Updates dynamically when chapters are selected/deselected",
          "Adjusts when text processing mode changes (speed=30%, summary=10%)",
          "Based on 150 words per minute narration rate"
        ],
        "performance": [
          "Instant — pure JS calculation, no server round-trip"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "Upload response includes words per chapter and total_words"
        ],
        "must_not_change": [],
        "can_modify": [
          "templates/index.html"
        ]
      },
      "attempts": [
        {
          "approach": "Pure JS: formatDuration(), PROCESSING_MULTIPLIERS, duration banner element, wired to chapter selection and processing mode change events",
          "timestamp": "2026-02-21T20:12:32.090203Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "templates/index.html",
            "test_duration.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:32.086394Z",
      "updated_at": "2026-02-21T20:12:32.094130Z"
    },
    "obj_bdfa47cc": {
      "id": "obj_bdfa47cc",
      "description": "TTL-based automatic cleanup of temp files and completed jobs",
      "user_experience": {
        "visible": [
          "GET /api/stats shows active_jobs, completed_jobs, total_disk_usage_mb"
        ],
        "behavior": [
          "Background loop runs every 10 minutes",
          "Removes completed/error/cancelled jobs older than 1 hour",
          "Cleans orphaned epub2mp3_* temp dirs older than 2 hours",
          "One-time cleanup of stale dirs on server startup",
          "completed_at timestamp set on jobs when they finish or error"
        ],
        "performance": [
          "Cleanup runs in background, no impact on request handling"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "app.py: jobs dict, job_dir temp paths, existing DELETE /api/cleanup/{id}"
        ],
        "must_not_change": [],
        "can_modify": [
          "app.py"
        ]
      },
      "attempts": [
        {
          "approach": "_cleanup_stale_jobs(), _cleanup_orphaned_tmp_dirs(), cleanup_loop() asyncio background task, startup event, GET /api/stats endpoint, completed_at tracking",
          "timestamp": "2026-02-21T20:12:59.326912Z",
          "result": "success",
          "learned": "",
          "files_changed": [
            "app.py",
            "test_cleanup.py"
          ]
        }
      ],
      "status": "Complete",
      "created_at": "2026-02-21T20:12:59.322625Z",
      "updated_at": "2026-02-21T20:12:59.330563Z"
    },
    "obj_75da3a63": {
      "id": "obj_75da3a63",
      "description": "Resilient audiobook conversion with resume support and persistent library",
      "user_experience": {
        "visible": [
          "Resume button on failed/interrupted jobs that picks up from the last completed chunk",
          "Persistent audiobook library panel showing all completed conversions with title, author, duration, and cover art",
          "Library survives server restarts — stored on disk, not just in memory or localStorage",
          "Progress indicator shows which chunks are already done when resuming"
        ],
        "behavior": [
          "When a job fails or is interrupted, intermediate chunk files are preserved on disk",
          "Resuming re-uses completed chunks and only re-processes failed/missing ones",
          "Completed audiobooks are catalogued in a JSON manifest on disk with metadata",
          "Library panel lets user download or re-download any past audiobook",
          "Library entries include: title, author, file size, duration, date created, cover art thumbnail",
          "Old library entries are not auto-deleted (user controls deletion)"
        ],
        "performance": [
          "Resume should feel instant for the already-completed portion"
        ]
      },
      "constraints": [],
      "examples": [],
      "context": {
        "existing_files": [
          "FastAPI app in app.py; conversion pipeline in converter.py; single-page HTML frontend in templates/index.html; job state currently in-memory dict; output files in temp dirs with 1hr TTL cleanup"
        ],
        "must_not_change": [
          "SSE streaming API contract, existing /api/convert endpoint signature"
        ],
        "can_modify": [
          "app.py, converter.py, templates/index.html, cli.py"
        ]
      },
      "attempts": [],
      "status": "NotStarted",
      "created_at": "2026-02-25T16:49:52.869256Z",
      "updated_at": "2026-02-25T16:49:52.869256Z"
    }
  }
}